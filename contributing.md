# Contributing

## Bug Reports

If you think you have found a bug in CTA, first make sure that you are testing against the latest version of Compass Test Automation - your issue may already have been fixed.
If not, search our [issues list](https://git.sami.int.thomsonreuters.com/compass/cta-master/issues) on GitLab in case a similar issue has already been opened.

It is very helpful if you can prepare a reproduction of the bug. In other words, provide a small test case which we can run to confirm your bug. It makes it easier to find the problem and to fix it.

## Feature Requests

If you find yourself wishing for a feature that doesn't exist in Compass Test Automation, you are probably not alone. There are bound to be others out there with similar needs.
Many of the features that Compass Test Automation has today have been added because our users saw the need.
Open an issue on our [issues list](https://git.sami.int.thomsonreuters.com/compass/cta-master/issues) with label `feature-request` on GitLab which describes the feature you would like to see, why you need it, and how it should work.

## Setting the environment

**Repository:** [https://git.sami.int.thomsonreuters.com/compass/cta-master](https://git.sami.int.thomsonreuters.com/compass/cta-master)

* Clone this repository
* Copy ./config/config.sample.js to ./config/config.js
* Provide your gitlab token in config.token field
* Optionally, provide other custom fields:
  * config.baseDir: your working directory where all projects will be cloned to. Default to the parent directory of this repo 
  * config.logFile: the fullpath to a logFile where to save logs. Default to "./logs/cta-master.log"
* Finally run:
  ````
  npm install
  ````

## Repository structure

Each CTA repository hosting a CTA module is structured identically.

- bin  : all scripts / executables to run / execute the module
- docs : the documentation generated by JSDoc and any complementary information about the module
- lib  : the lib directory contains all source code
- test : the test directory contains all tests of the module : unit tests, functional tests, etc.
  - test/unit/lib/package/class.test.js : a unit test for class.js found under /lib/package
    - test/unit/lib/package/class.method.test.js : we can test each of method for class.js
  - test/functional/lib/functionality.test.js : all functional tests for a given functionality
  
## Coding Guidelines

* We follow [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript) using ECMAScript 6
* Javascript indent is 2 spaces
* Line width is 100 characters
* Maximum size for a function is 25 lines, should a function require more lines, code should be broken in sub functions and potential moved to helper files.
* Maximum size for a file is 250 lines
* Disable "auto-format on save" to prevent unnecessary format changes. This makes reviews much harder as it generates unnecessary formatting changes. If your IDE supports formatting only modified chunks that is fine to do.

## Documentation

All code should be documented using [JSDoc](http://usejsdoc.org/)

### Class

A description of the class should be provided with examples of instantiations and main usages of the class.

### Method

A description of each method and constructor should be provided with a list of parameters to provide, their
type, their role with an example of a call to help developer to quickly sketch usage of the method.

## Test Driven Development

CTA is developped with TDD in mind. This means that prior to writing code, we start by writing tests for the code that is to be written.
This forces us to thinking about the different usage, use cases that will apply to the code to be developped and ensure that all our
code is validated by tests.

### Unit Tests 

Unit tests are located under /test/unit/lib as for each codefile.js under lib is associated a corresponding codefile.test.js unit test file.

### Functional Tests 

** TODO FINISH **
/test/functional/lib
Sometimes, one will want to write some tests validating a functionaly of the module. Such tests spanning several 

### Code Coverage

To ensure a good coverage of the source code by your tests, please use
  ````
  npm coverage
  ```` 
This command will run all unit tests and functional tests and validate the overall coverage of the source code by your tests.

A minimum of 90% code coverage is expected by your tests.
  
## Contributing code and documentation changes

If you have a bugfix or new feature that you would like to contribute to Compass Test Automation, please find or open an issue about it first. Talk about what you would like to do.
It may be that somebody is already working on it, or that there are particular issues that you should know about before implementing the change.

We enjoy working with contributors to get their code accepted. There are many approaches to fixing a problem and it is important to find the best approach before writing too much code.

The process for contributing to any of the [Compass Test Automation repositories](https://git.sami.int.thomsonreuters.com/compass/cta-master) is similar. Details can be found below.

### Fork and clone the repository

You will need to fork the [Compass Test Automation repository ](https://git.sami.int.thomsonreuters.com/compass/cta-master)and clone it to your local machine.

### Submitting your changes

1. Make your changes in a new git branch. The branch name should include the issue number you created for the "new" feature you provided or the existing issue number you are providing a "fix" for.
  branch name should be formatted as: cta - [ new | fix ] - [ issue number ] - [ contributor name/nick/alias ]

  `git checkout -b cta-fix-404-batman master` or `git checkout -b cta-new-42-robin master`

2. Sign the Contributor License Agreement

    Please make sure you have signed our [Contributor License Agreement](https://git.sami.int.thomsonreuters.com/compass/cta-master/blob/master/Compass%20Test%20Automation-Individual.pdf) brefore sending pull requests. 

3. Create your patch, including appropriate test cases.

4. Often rebase your repository to ensure following latest changes

5. Run the full grunt task and ensure that all tests pass. `npm run testAll`

6. Commit your changes using a descriptive commit message

7. Submit a pull request

    Push your local changes to your forked copy of the repository and submit a pull request. In the pull request, choose a title which sums up the changes that you have made, 
    and in the body provide more details about what your changes do. Also mention the number of the issue where discussion has taken place, eg "Issue #123".

Thank you for your contribution!